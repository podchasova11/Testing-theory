[05.12.2025 8:11]
–†–µ—á—å –∏–¥–µ—Ç –æ —Ñ–ª–∞–∫–∏ (flake) —Ç–µ—Å—Ç–∞—Ö ‚Äî –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–æ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç, –∞ –∏–Ω–æ–≥–¥–∞ –ø–∞–¥–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–æ—Ä—å–±—ã —Å –Ω–∏–º–∏ –≤ Python AQA:

### üîç –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç–æ–≤

1. –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: API, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
2. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –≥–æ–Ω–∫–∏ –ø–æ—Ç–æ–∫–æ–≤, –Ω–µ–æ—á–∏—â–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
3. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: sleep(), —Ç–∞–π–º–∞—É—Ç—ã, –¥–∞—Ç–∞/–≤—Ä–µ–º—è
4. –•—Ä—É–ø–∫–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ UI, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ ID
5. –ü—Ä–æ–±–ª–µ–º—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è: —Ä–∞–∑–ª–∏—á–∏—è –≤ –û–°, –≤–µ—Ä—Å–∏—è—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

### üõ°Ô∏è –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–æ—Ä—å–±—ã —Å —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç–∞–º–∏

### 1. –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–∑–æ–ª—è—Ü–∏—è
~~~
# pytest-flakefinder –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç–æ–≤
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞: pip install pytest-flakefinder
~~~
## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ 100 —Ä–∞–∑ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
```
pytest test_example.py --flake-finder --flake-runs=100
```
## –û—Ç–º–µ—Ç–∏—Ç—å —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å
```
import pytest

@pytest.mark.flaky(reruns=3)  # pytest-rerunfailures
def test_unstable_api():
    response = call_external_api()
    assert response.status_code == 200

# pytest.mark.xfail –¥–ª—è –æ–∂–∏–¥–∞–µ–º–æ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
@pytest.mark.xfail(reason="External API‰∏çÁ®≥ÂÆö", strict=False)
def test_third_party_service():
```

### 2. –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∫–æ–≤ –∏ —Å—Ç–∞–±–æ–≤ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
from unittest.mock import Mock, patch
import requests

def test_with_mocked_api():
    # –ó–∞–º–æ–∫–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π API
    with patch('requests.get') as mock_get:
        mock_response = Mock()
        mock_response.status_code = 200
        mock_response.json.return_value = {"status": "ok"}
        mock_get.return_value = mock_response
        
        result = get_api_data()
        assert result["status"] == "ok"

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
import pytest

@pytest.fixture
def clean_database():
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
    db.connect()
    yield
    # –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞
    db.clear_all()
    db.disconnect()

def test_with_clean_db(clean_database):
    # –¢–µ—Å—Ç —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —á–∏—Å—Ç—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
    db.insert_test_data()
    assert db.count_records() == 1

### 3. –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–∂–∏–¥–∞–Ω–∏—è
# –ó–ê–ü–†–ï–©–ï–ù–û: –•—Ä—É–ø–∫–∏–µ sleep()
import time
def test_bad_example():
    click_button()
    time.sleep(5)  # ‚ùå –ñ–µ—Å—Ç–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
    assert element_is_visible()

# –õ—É—á—à–µ: –Ø–≤–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è (explicit waits)
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By

def test_good_example(driver):
    driver.click_button()
    # –ñ–¥–∞—Ç—å –¥–æ 10 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Ç–∞–Ω–µ—Ç –≤–∏–¥–∏–º—ã–º
    element = WebDriverWait(driver, 10).until(
        EC.visibility_of_element_located((By.ID, "result"))
    )
    assert element.text == "Success"

# –ö–∞—Å—Ç–æ–º–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –æ–∂–∏–¥–∞–Ω–∏—è
def text_changes(locator, initial_text):
    """–ö–∞—Å—Ç–æ–º–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞."""
    def _predicate(driver):
        current = driver.find_element(*locator).text
        return current != initial_text
    return _predicate

def test_with_custom_wait(driver):
    initial = driver.find_element(By.ID, "status").text
    trigger_change()
    WebDriverWait(driver, 10).until(
        text_changes((By.ID, "status"), initial)
    )

### 4. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ –∏ –∫–≤–æ—Ä—É–º—ã
# pytest-rerunfailures –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞: pip install pytest-rerunfailures

# –í –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ:
pytest --reruns 3 --reruns-delay 2  # 3 –ø–æ–≤—Ç–æ—Ä–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 2 —Å–µ–∫—É–Ω–¥—ã

# –ò–ª–∏ –≤ –∫–æ–¥–µ —Ç–µ—Å—Ç–∞:
@pytest.mark.flaky(reruns=3, reruns_delay=2)
def test_flaky_network():
    # –¢–µ—Å—Ç —Å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º —Å–µ—Ç–µ–≤—ã–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
    download_file()

# –ö–≤–æ—Ä—É–º–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (quorum assertions)
def quorum_assertion(func, expected_result, attempts=5):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç–∞–±–∏–ª–µ–Ω –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö."""
    results = []
    for _ in range(attempts):
        try:
            result = func()
            results.append(result)
        except:
            results.append(None)
    
    # –¢—Ä–µ–±—É–µ–º 80% —É—Å–ø–µ—à–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    success_count = results.count(expected_result)
    assert success_count / attempts >= 0.8, f"–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {results}"

### 5. –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è —Å –∏–∑–æ–ª—è—Ü–∏–µ–π

Mila Podchasova, [05.12.2025 8:11]
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pytest-xdist —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞: pip install pytest-xdist

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
pytest -n 4 --forked  # 4 –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å –∏–∑–æ–ª—è—Ü–∏–µ–π

# –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–∫—Å—Ç—É—Ä
import pytest
import tempfile
import os

@pytest.fixture(scope="function")  # –ù–æ–≤–∞—è —Ñ–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
def isolated_env():
    # –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    with tempfile.TemporaryDirectory() as tmpdir:
        original_env = os.environ.copy()
        os.environ["TEST_DIR"] = tmpdir
        yield tmpdir
        # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        os.environ.clear()
        os.environ.update(original_env)

## üìä –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1. –í—ã—è–≤–∏—Ç—å —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç—ã:
     # –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∞–¥–µ–Ω–∏–π
   pytest --flake-finder --flake-runs=50 -v > flaky_report.txt
   
   # –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–æ–≤
   # (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ CI/CD: Jenkins, GitLab CI, GitHub Actions)
   
2. –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–∏–ø—É –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:
   - –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Üí –º–æ–∫–∏/—Å—Ç–∞–±—ã
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
   - –í—Ä–µ–º—è ‚Üí —è–≤–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è
   - UI ‚Üí —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

3. –ü—Ä–∏–æ—Ä–∏—Ç–µ–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
   1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (–ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
   2. –ß–∞—Å—Ç–æ –ø–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã
   3. –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç—ã

4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
     # –í–∫–ª—é—á–∏—Ç—å –≤ CI/CD –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç–æ–≤
   # –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
   # –î–∞—à–±–æ—Ä–¥ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤
   
## üö´ –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å —Å —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç–∞–º–∏

- ‚ùå –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å ‚Äî —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –∏—Ö —Å—Ç–∞–Ω–µ—Ç –±–æ–ª—å—à–µ
- ‚ùå –ù–µ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å sleep() ‚Äî —ç—Ç–æ –º–∞—Å–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—É
- ‚ùå –ù–µ –æ—Ç–∫–ª—é—á–∞—Ç—å –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞ ‚Äî –ø–æ—Ç–µ—Ä—è –ø–æ–∫—Ä—ã—Ç–∏—è
- ‚ùå –ù–µ –ø–∏—Å–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏ ‚Äî –ª—É—á—à–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ—Ä–µ–Ω–Ω—É—é –ø—Ä–∏—á–∏–Ω—É

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- pytest-rerunfailures ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã
- pytest-flakefinder ‚Äî –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–ª–∞–∫–∏-—Ç–µ—Å—Ç–æ–≤  
- pytest-xdist ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- mock/patch (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ) ‚Äî –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- tox ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö

–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø: –ª—É—á—à–µ –æ–¥–∏–Ω —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç, —á–µ–º –¥–µ—Å—è—Ç—å —Ñ–ª–∞–∫–∏. –ù–∞—á–Ω–∏—Ç–µ —Å –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏ —á–∞—Å—Ç–æ –ø–∞–¥–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤, –ø—Ä–∏–º–µ–Ω—è—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

